<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="../../lib/jquery-2.0.3.js"></script>
    <script src="vendor/mocha.js"></script>
    <script src="vendor/require.js"></script>
    <script src="config.js" ></script>
    <link href="../../dist/stylesheets/toolkit.css" rel="stylesheet"/>


</head>
<body class='grid-1140'>
<!--PLACEHOLDER FOR MOCHA TEST RESULTS-->
<div id="mocha"></div>
<style>.to</style>
<!--FIXTURE HTML FOR TESTS-->
<div id="spec-markup">
    <div class="skycom-container">
        <div class="video" data-video-id="clip-00cwoia5">
            <img src="../../wiki_images/bling-ring.jpg"
                 alt="David Beckham with Sky Sports Living for Sport participants Adam Brown, Eden Anderson, Michele Meola, Maariyah Atta, Conor Greensmith and Nahida Begum">
            <a href="#" class="play-video"
               data-tracking-context="David Beckham And Sky Team Up">
                <i class="icon-video-play"></i>
                <span class="speak">Play Trailer</span>
            </a>
        </div>
    </div>
</div>

<!--TEST-->
<script>

    require(['modules/video', '../../test/jsUnit/setup'],function(){
        var options = {
            token:"8D5B12D4-E1E6-48E8-AF24-F7B13050EE85",
            animationSpeed: 0,
            freewheel:false //disable ads
        };
        $('#spec-markup').show();
        var video = new toolkit.video($('.video'), options);
        video.createWrapper();

        describe('Video module', function() {

            it('showCanvas will expand the video container', function(){
                var ratio = $('.video').width() / $('.video').height();
                var $container = $('.video'),
                        $wrapper = $('.video .video-wrapper'),
                        $close = $wrapper.find('.close'),
                        callbackCalled = false;

                video.showCanvas(function() {
                    callbackCalled = true;
                });
                expect($wrapper.attr('class')).to.contain('playing-video');
                expect($wrapper.length).to.equal(1);
                expect($close.attr('class')).to.contain("active");
                expect(callbackCalled).to.be.true;

            });

            it('hideCanvas will collapse the container and hide the video', function(){
                var $container = $('.video'),
                        $wrapper = $('.video .video-wrapper'),
                        $overlay = $('.video .video-overlay'),
                        $close = $wrapper.find('.close'),
                        callbackCalled = false, ratio;
                video.showCanvas(function() {});
                video.hideCanvas();
                expect($close.attr('class')).to.not.include("active");
                expect($overlay.attr('style')).to.contain("display: none;");
                expect($wrapper.attr('class')).to.not.include("playing-video");
            });

            it('stop will stop the video', function(){
                var $container = $('.video'),
                        $wrapper = $('.video .video-wrapper'),
                        $overlay = $('.video .video-overlay'),
                        $close = $wrapper.find('.close'),
                        callbackCalled = false, skyPlayCalled = false, ratio;
                sky =  {
                    html5player: {
                        close: function(blah) {
                            skyPlayCalled = true;
                        }
                    }
                }
                video.stop();
                expect(skyPlayCalled).to.be.true;
                expect($wrapper.length).to.equal(0);
            });

            it('play will start the video', function(done){
                var $container = $('.video'),
                        $wrapper = $('.video .video-wrapper'),
                        $overlay = $('.video .video-overlay'),
                        $close = $wrapper.find('.close'),
                        callbackCalled = false, skyPlayCalled = false;
                sky =  {
                    html5player: {
                        play: function() {
                            skyPlayCalled = true;
                        }
                    }
                }
                $.fn.sky_html5player = function(blah) {};
                toolkit.video.prototype.showCanvas = function(callback) { callback(); callbackCalled = true}
                video.play();
                expect(callbackCalled).to.be.true;
                setTimeout(function() {
                    expect(skyPlayCalled).to.be.true;
                    done();
                },1334)
            });

        });
        mocha.run();
    });
</script>

</body>
</html>
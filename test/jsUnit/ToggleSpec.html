<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="../../lib/jquery-2.0.3.js"></script>
    <script src="vendor/mocha.js"></script>
    <script src="vendor/require.js"></script>
    <script src="config.js"></script>
</head>
<body>
<!--PLACEHOLDER FOR MOCHA TEST RESULTS-->
<div id="mocha"></div>

<!--FIXTURE HTML FOR TESTS-->
<div class="skycom-container main">
    <section id="toggle-by-element" data-mode=view>
        <a class="toggle-link" data-toggle='#toggle-by-element .edit-container' data-toggle-text="Show"
           data-tracking-label="Show" data-toggle-state='shown'>Hide</a>

        <div class="edit-container">
            <h3>Some content</h3>
        </div>
    </section>

    <section id="toggle-by-container" data-mode=view>
        <a class="toggle-link" data-toggle='#container-to-toggle' data-toggle-text="Show" data-tracking-label="Show"
           data-toggle-state='shown'><span>Hide</span><i class="icon"></i></a>

        <div class="edit-container" id="container-to-toggle">
            <h3>Some content</h3>
        </div>
    </section>


    <section id="toggle-already-done" data-mode=view>
        <a class="toggle-link" data-toggle='#container-to-toggle-done' data-toggle-text="Show"
           data-tracking-label="Show" data-toggle-state='shown'>Hide</a>

        <div class="edit-container" id="container-to-toggle-done" data-toggle-state="shown">
            <h3>Some content</h3>
        </div>
    </section>
</div>

<!--TEST-->
<script>
    require(['utils/toggle',
        '../../test/jsUnit/setup'], function (toggle) {


        var describeSpec = 'Toggling elements visibility';

        if(!toggle) { //needed for running tests in demo page
            toggle = toolkit.toggle;
        }

        describe(describeSpec, function () {

            it('can toggle based on the element that was clicked on', function () {
                var container = $('#toggle-by-element .edit-container');
                var toggleLink = $("#toggle-by-element .toggle-link");

                expect(container.hasClass('toggle-hidden')).to.be.false;

                toggle({$elClicked:toggleLink});
                expect(toggleLink.attr("data-toggle-state")).to.equal("hidden");
                expect(toggleLink.attr("data-toggle-text")).to.equal("Hide");
                expect(toggleLink.attr("data-tracking-label")).to.equal("Hide");
                expect(toggleLink.text()).to.equal("Show");
                expect(container.hasClass('toggle-hidden')).to.be.true;

                toggle({$elClicked:toggleLink});
                expect(toggleLink.attr("data-toggle-state")).to.equal("shown");
                expect(toggleLink.attr("data-toggle-text")).to.equal("Show");
                expect(toggleLink.attr("data-tracking-label")).to.equal("Show");
                expect(toggleLink.text()).to.equal("Hide");
                expect(container.hasClass('toggle-hidden')).to.be.false;

            });


            it('can toggle by passing the id of the container and state to toggle to', function () {

                var container = $('#toggle-by-container .edit-container');
                var toggleLink = $("#toggle-by-container .toggle-link");

                expect(container.hasClass('toggle-hidden')).to.be.false;

                toggle({$container:container, action:'hide'});
                expect(toggleLink.attr("data-toggle-state")).to.equal("hidden");
                expect(toggleLink.attr("data-toggle-text")).to.equal("Hide");
                expect(toggleLink.attr("data-tracking-label")).to.equal("Hide");
                expect(toggleLink.text()).to.equal("Show");
                expect(container.hasClass('toggle-hidden')).to.be.true;

                toggle({$container:container, action:'show'});
                expect(container.hasClass('toggle-hidden')).to.be.false;
                expect(toggleLink.attr("data-toggle-state")).to.equal("shown");
                expect(toggleLink.attr("data-toggle-text")).to.equal("Show");
                expect(toggleLink.attr("data-tracking-label")).to.equal("Show");
                expect(toggleLink.text()).to.equal("Hide");

            });

            it("only changes the text inside a span if a span exists", function () {
                var container = $('#toggle-by-container .edit-container');
                var toggleLink = $("#toggle-by-container .toggle-link");
                toggle({$container:container, action:'hide'});
                expect(toggleLink.text()).to.equal("Show");
                toggle({$container:container, action:'show'});
                expect(toggleLink.text()).to.equal("Hide");
                expect(toggleLink.find('i').length).to.equal(1);
            });

            it('doesnt do anything if the container is already toggled to the state you are trying to change to', function () {

                var container = $('#toggle-already-done .edit-container');
                var toggleLink = $("#toggle-already-done .toggle-link");

                expect(container.hasClass('toggle-hidden')).to.be.false;
                expect(toggleLink.attr("data-toggle-state")).to.equal("shown");
                expect(toggleLink.attr("data-toggle-text")).to.equal("Show");
                expect(toggleLink.attr("data-tracking-label")).to.equal("Show");
                expect(toggleLink.text()).to.equal("Hide");

                toggle({$container:container, action:'show'});
                expect(container.hasClass('toggle-hidden')).to.be.false;
                expect(toggleLink.attr("data-toggle-state")).to.equal("shown");
                expect(toggleLink.attr("data-toggle-text")).to.equal("Show");
                expect(toggleLink.attr("data-tracking-label")).to.equal("Show");
                expect(toggleLink.text()).to.equal("Hide");

            });

        });

        mocha.run();
    });
</script>

</body>
</html>
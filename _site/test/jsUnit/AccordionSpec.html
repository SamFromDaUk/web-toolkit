<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="../../static/lib/jquery-2.0.3.js"></script>
    <script src="../vendor/mocha.js"></script>
    <script src="../vendor/require.js"></script>
    <script src="config.js" ></script>

</head>
<body>
<!--PLACEHOLDER FOR MOCHA TEST RESULTS-->
<div id="mocha"></div>

<!--FIXTURE HTML FOR TESTS-->


<div id="spec-markup">


    <ul class="accordion">
        <li>
            <a class="accordion-heading colour" data-toggle="#first-accordion-content" href="#first-accordion-content">
                <span>First Accordion Item</span> <i class="skycon-chevron-down"></i>
            </a>
            <div id="first-accordion-content" class="view-container toggle-hidden">
                <div class=accordion-content>
                    <p style="margin: 0;">First Accordion content which goes on to a ton of lines</p>
                </div>
            </div>
        </li>
        <li>
            <a class="accordion-heading colour" data-toggle="#second-accordion-content" href="#second-accordion-content">
                <span>Second Accordion Item</span> <i class="skycon-chevron-down"></i></span>
            </a>
            <div id="second-accordion-content" class="view-container toggle-hidden">
                <div class=accordion-content>
                    <p style="margin: 0; height: 400px; background-color: #f00;">Second Accordion content</p>
                </div>
            </div>
        </li>
        <li>
            <a class="accordion-heading colour" data-toggle="#third-accordion-content" href="#third-accordion-content">
                <span>Third Accordion Item</span> <i class="skycon-chevron-down"></i>
            </a>
            <div id="third-accordion-content" class="view-container toggle-hidden">
                <div class=accordion-content>
                    <p style="margin: 0;">Third Accordion content</p>
                </div>
            </div>
        </li>
    </ul>

</div>

</div>

<!--TEST-->
<script>

    require(['components/accordion', '../../test/jsUnit/setup'],function(){

        $('.accordion').accordion();

        var describeSpec = 'Accordion module';

        describe(describeSpec, function () {

            it('Accordion content should be closed by default', function () {
                expect($('.view-container.toggle-hidden').length).to.equal(3);
            });

            it('Accordion content should open and close when a user clicks an accordion item twice', function () {
                var $first = $('.view-container').first();
                var $firstLink = $('.accordion-heading').first();
                var $last = $('.view-container').last();
                var $lastLink = $('.accordion-heading').last();
                expect($first.hasClass('toggle-hidden')).to.equal(true);
                expect($first.parent().find('> a i').hasClass('rotate-180')).to.equal(false);
                $firstLink.click();
                expect($first.hasClass('toggle-hidden')).to.equal(false);
                expect($first.parent().find('> a i').hasClass('rotate-180')).to.equal(true);
                expect($last.hasClass('toggle-hidden')).to.equal(true);
                $lastLink.click();
                expect($last.hasClass('toggle-hidden')).to.equal(false);
                expect($first.parent().find('> a i').hasClass('rotate-180')).to.equal(true);
                $firstLink.click();
                expect($first.hasClass('toggle-hidden')).to.equal(true);
                expect($first.parent().find('> a i').hasClass('rotate-180')).to.equal(false);
                expect($last.hasClass('toggle-hidden')).to.equal(false);
            });
        });

        mocha.run();
    });
</script>

</body>
</html>